# Plan: Update Documentation for Julia Setup

## Scope

Documentation only -- no code changes to Julia files.

## Review Findings

### Current state

- `server/src/Server.jl` wraps routes inside a `serve()` function to avoid the Oxygen precompilation problem. This works but is not the recommended `@oxidize` pattern. (Code change deferred.)
- `server/debug.jl` uses `using Revise` before `using Server` for implicit tracking -- valid but doesn't leverage Oxygen's `revise=:eager`/`:lazy`. (Code change deferred.)
- `server/run.jl` correctly omits Revise for production.
- `Revise` is in `[deps]` rather than `[extras]` -- minor, acceptable since Julia lacks formal dev deps.

### Issues in existing docs

1. **AGENTS.md line 41** says "loaded via Revise.includet for hot reload" -- **incorrect**. The project uses `using Revise` + `using Server` (package-based tracking), not `includet`.
2. **README.md** is the default SvelteKit template with no project-specific info.

---

## Changes

### 1. AGENTS.md

#### Fix incorrect Revise description (line 41)

Replace:

```
server/         # Julia HTTP server (Oxygen.jl); routes in server/src/Server.jl, loaded via Revise.includet for hot reload
```

With:

```
server/         # Julia HTTP server (Oxygen.jl); routes in server/src/Server.jl
```

#### Add Julia section after the Project Structure section

Add a new `## Julia Backend` section covering:

- Architecture: Oxygen.jl HTTP server on port 8080, proxied via Vite at `/api`
- Route registration pattern: routes registered inside `serve()` to avoid the precompilation issue with `@get` macros at module scope
- Hot reload: `debug.jl` loads `Revise` before `Server` for automatic code tracking; `run.jl` skips Revise for production
- Adding routes: define new `@get`/`@post` handlers inside the `serve()` function in `server/src/Server.jl`
- Use `json()` render function for JSON responses
- julia-mcp: gives AI agents `julia_eval()` access to a persistent Julia REPL session

#### Update Notes section

Add:

- `pnpm run dev` starts both Vite and Julia concurrently; edits to `server/src/Server.jl` are hot-reloaded via Revise
- Never edit `server/Manifest.toml` by hand (auto-generated by Pkg)

### 2. README.md

Replace the entire file with project-specific content:

````markdown
# test-opencode

SvelteKit frontend + Julia (Oxygen.jl) API server.

## Prerequisites

- Node.js 20+, pnpm
- Julia 1.12+
- uv (for julia-mcp MCP server)

## Setup

```sh
git submodule update --init
pnpm install
julia --project=server -e 'using Pkg; Pkg.instantiate()'
```
````

## Development

```sh
pnpm run dev
```

Starts both the Vite dev server (`:5173`) and the Julia API server (`:8080`) with hot reload via Revise. Frontend requests to `/api/*` are proxied to the Julia server.

## Production Build

```sh
pnpm run build              # SvelteKit
julia --project=server server/run.jl  # Julia (no Revise)
```

## Architecture

```
Browser --> Vite (:5173) --> SvelteKit (frontend)
               \--> /api/* proxy --> Oxygen.jl (:8080)

OpenCode --> julia-mcp (stdio MCP) --> persistent Julia REPL
```

## API Endpoints

| Method | Path           | Description                                                     |
| ------ | -------------- | --------------------------------------------------------------- |
| GET    | `/health`      | Health check (`{"status": "ok"}`)                               |
| GET    | `/eigvals/{n}` | Eigenvalues of a random n x n symmetric matrix (n clamped 2..6) |

## Julia MCP

The `julia-mcp` git submodule provides AI agents with `julia_eval()` access via the MCP protocol. Configured in `opencode.jsonc`.

```

---

## Verification

After applying changes:
- `pnpm run check` -- should pass (no TS/Svelte changes)
- `pnpm run lint` -- should pass (no JS/TS changes)
- Review AGENTS.md and README.md manually for accuracy
```
